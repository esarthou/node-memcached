{"/Users/esteban/node-memcached/server/src/server.js":{"path":"/Users/esteban/node-memcached/server/src/server.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":8,"column":11},"end":{"line":8,"column":49}},"3":{"start":{"line":10,"column":14},"end":{"line":10,"column":57}},"4":{"start":{"line":12,"column":13},"end":{"line":12,"column":55}},"5":{"start":{"line":14,"column":39},"end":{"line":14,"column":93}},"6":{"start":{"line":16,"column":44},"end":{"line":16,"column":195}},"7":{"start":{"line":16,"column":62},"end":{"line":16,"column":166}},"8":{"start":{"line":16,"column":176},"end":{"line":16,"column":193}},"9":{"start":{"line":16,"column":196},"end":{"line":16,"column":207}},"10":{"start":{"line":18,"column":21},"end":{"line":18,"column":26}},"11":{"start":{"line":19,"column":21},"end":{"line":19,"column":32}},"12":{"start":{"line":20,"column":15},"end":{"line":20,"column":36}},"13":{"start":{"line":24,"column":4},"end":{"line":50,"column":7}},"14":{"start":{"line":26,"column":6},"end":{"line":26,"column":76}},"15":{"start":{"line":28,"column":6},"end":{"line":41,"column":9}},"16":{"start":{"line":29,"column":8},"end":{"line":29,"column":77}},"17":{"start":{"line":31,"column":8},"end":{"line":40,"column":9}},"18":{"start":{"line":32,"column":32},"end":{"line":32,"column":74}},"19":{"start":{"line":33,"column":10},"end":{"line":36,"column":13}},"20":{"start":{"line":34,"column":12},"end":{"line":34,"column":44}},"21":{"start":{"line":35,"column":12},"end":{"line":35,"column":36}},"22":{"start":{"line":38,"column":10},"end":{"line":38,"column":73}},"23":{"start":{"line":39,"column":10},"end":{"line":39,"column":36}},"24":{"start":{"line":43,"column":6},"end":{"line":45,"column":9}},"25":{"start":{"line":44,"column":8},"end":{"line":44,"column":94}},"26":{"start":{"line":47,"column":6},"end":{"line":49,"column":9}},"27":{"start":{"line":48,"column":8},"end":{"line":48,"column":96}},"28":{"start":{"line":52,"column":4},"end":{"line":52,"column":23}},"29":{"start":{"line":53,"column":4},"end":{"line":53,"column":38}},"30":{"start":{"line":57,"column":4},"end":{"line":57,"column":45}},"31":{"start":{"line":58,"column":4},"end":{"line":58,"column":45}},"32":{"start":{"line":59,"column":4},"end":{"line":59,"column":67}},"33":{"start":{"line":60,"column":4},"end":{"line":62,"column":7}},"34":{"start":{"line":61,"column":6},"end":{"line":61,"column":73}},"35":{"start":{"line":71,"column":4},"end":{"line":109,"column":5}},"36":{"start":{"line":72,"column":6},"end":{"line":108,"column":7}},"37":{"start":{"line":74,"column":10},"end":{"line":74,"column":58}},"38":{"start":{"line":74,"column":37},"end":{"line":74,"column":56}},"39":{"start":{"line":77,"column":10},"end":{"line":77,"column":59}},"40":{"start":{"line":77,"column":37},"end":{"line":77,"column":57}},"41":{"start":{"line":80,"column":10},"end":{"line":80,"column":61}},"42":{"start":{"line":80,"column":37},"end":{"line":80,"column":59}},"43":{"start":{"line":83,"column":10},"end":{"line":83,"column":78}},"44":{"start":{"line":86,"column":10},"end":{"line":86,"column":78}},"45":{"start":{"line":89,"column":10},"end":{"line":89,"column":82}},"46":{"start":{"line":92,"column":10},"end":{"line":92,"column":57}},"47":{"start":{"line":95,"column":10},"end":{"line":95,"column":58}},"48":{"start":{"line":98,"column":10},"end":{"line":98,"column":93}},"49":{"start":{"line":101,"column":10},"end":{"line":101,"column":38}},"50":{"start":{"line":104,"column":10},"end":{"line":104,"column":54}},"51":{"start":{"line":107,"column":10},"end":{"line":107,"column":27}},"52":{"start":{"line":111,"column":4},"end":{"line":111,"column":28}},"53":{"start":{"line":116,"column":0},"end":{"line":116,"column":25}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":14,"column":9},"end":{"line":14,"column":31}},"loc":{"start":{"line":14,"column":37},"end":{"line":14,"column":95}},"line":14},"1":{"name":"_defineProperty","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":24}},"loc":{"start":{"line":16,"column":42},"end":{"line":16,"column":209}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":2},"end":{"line":23,"column":3}},"loc":{"start":{"line":23,"column":16},"end":{"line":54,"column":3}},"line":23},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":46},"end":{"line":24,"column":47}},"loc":{"start":{"line":24,"column":56},"end":{"line":50,"column":5}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":28,"column":24},"end":{"line":28,"column":25}},"loc":{"start":{"line":28,"column":32},"end":{"line":41,"column":7}},"line":28},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":32},"end":{"line":33,"column":33}},"loc":{"start":{"line":33,"column":44},"end":{"line":36,"column":11}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":43,"column":25},"end":{"line":43,"column":26}},"loc":{"start":{"line":43,"column":31},"end":{"line":45,"column":7}},"line":43},"7":{"name":"(anonymous_7)","decl":{"start":{"line":47,"column":25},"end":{"line":47,"column":26}},"loc":{"start":{"line":47,"column":34},"end":{"line":49,"column":7}},"line":47},"8":{"name":"(anonymous_8)","decl":{"start":{"line":56,"column":2},"end":{"line":56,"column":3}},"loc":{"start":{"line":56,"column":17},"end":{"line":63,"column":3}},"line":56},"9":{"name":"(anonymous_9)","decl":{"start":{"line":60,"column":45},"end":{"line":60,"column":46}},"loc":{"start":{"line":60,"column":51},"end":{"line":62,"column":5}},"line":60},"10":{"name":"(anonymous_10)","decl":{"start":{"line":70,"column":2},"end":{"line":70,"column":3}},"loc":{"start":{"line":70,"column":21},"end":{"line":112,"column":3}},"line":70},"11":{"name":"(anonymous_11)","decl":{"start":{"line":74,"column":30},"end":{"line":74,"column":31}},"loc":{"start":{"line":74,"column":37},"end":{"line":74,"column":56}},"line":74},"12":{"name":"(anonymous_12)","decl":{"start":{"line":77,"column":30},"end":{"line":77,"column":31}},"loc":{"start":{"line":77,"column":37},"end":{"line":77,"column":57}},"line":77},"13":{"name":"(anonymous_13)","decl":{"start":{"line":80,"column":30},"end":{"line":80,"column":31}},"loc":{"start":{"line":80,"column":37},"end":{"line":80,"column":59}},"line":80}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":46},"end":{"line":14,"column":92}},"type":"cond-expr","locations":[{"start":{"line":14,"column":70},"end":{"line":14,"column":73}},{"start":{"line":14,"column":76},"end":{"line":14,"column":92}}],"line":14},"1":{"loc":{"start":{"line":14,"column":46},"end":{"line":14,"column":67}},"type":"binary-expr","locations":[{"start":{"line":14,"column":46},"end":{"line":14,"column":49}},{"start":{"line":14,"column":53},"end":{"line":14,"column":67}}],"line":14},"2":{"loc":{"start":{"line":16,"column":44},"end":{"line":16,"column":195}},"type":"if","locations":[{"start":{"line":16,"column":44},"end":{"line":16,"column":195}},{"start":{"line":16,"column":44},"end":{"line":16,"column":195}}],"line":16},"3":{"loc":{"start":{"line":57,"column":16},"end":{"line":57,"column":44}},"type":"binary-expr","locations":[{"start":{"line":57,"column":16},"end":{"line":57,"column":28}},{"start":{"line":57,"column":32},"end":{"line":57,"column":44}}],"line":57},"4":{"loc":{"start":{"line":58,"column":16},"end":{"line":58,"column":44}},"type":"binary-expr","locations":[{"start":{"line":58,"column":16},"end":{"line":58,"column":28}},{"start":{"line":58,"column":32},"end":{"line":58,"column":44}}],"line":58},"5":{"loc":{"start":{"line":71,"column":4},"end":{"line":109,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":109,"column":5}},{"start":{"line":71,"column":4},"end":{"line":109,"column":5}}],"line":71},"6":{"loc":{"start":{"line":72,"column":6},"end":{"line":108,"column":7}},"type":"switch","locations":[{"start":{"line":73,"column":8},"end":{"line":74,"column":58}},{"start":{"line":76,"column":8},"end":{"line":77,"column":59}},{"start":{"line":79,"column":8},"end":{"line":80,"column":61}},{"start":{"line":82,"column":8},"end":{"line":83,"column":78}},{"start":{"line":85,"column":8},"end":{"line":86,"column":78}},{"start":{"line":88,"column":8},"end":{"line":89,"column":82}},{"start":{"line":91,"column":8},"end":{"line":92,"column":57}},{"start":{"line":94,"column":8},"end":{"line":95,"column":58}},{"start":{"line":97,"column":8},"end":{"line":98,"column":93}},{"start":{"line":100,"column":8},"end":{"line":101,"column":38}},{"start":{"line":103,"column":8},"end":{"line":104,"column":54}},{"start":{"line":106,"column":8},"end":{"line":107,"column":27}}],"line":72}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":3,"6":1,"7":0,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":19,"17":19,"18":19,"19":19,"20":19,"21":19,"22":0,"23":0,"24":1,"25":0,"26":1,"27":0,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":19,"36":19,"37":8,"38":8,"39":1,"40":1,"41":1,"42":1,"43":4,"44":1,"45":1,"46":1,"47":1,"48":1,"49":0,"50":0,"51":0,"52":0,"53":1},"f":{"0":3,"1":1,"2":1,"3":1,"4":19,"5":19,"6":0,"7":0,"8":1,"9":1,"10":19,"11":8,"12":1,"13":1},"b":{"0":[2,1],"1":[3,3],"2":[0,1],"3":[1,0],"4":[1,0],"5":[19,0],"6":[8,1,1,4,1,1,1,1,1,0,0,0]},"inputSourceMap":{"version":3,"sources":["server.js"],"names":["DEFAULT_PORT","DEFAULT_HOST","parser","Parser","Server","constructor","socket","console","log","remoteAddress","remotePort","on","data","responseArray","handleCommand","translate","forEach","response","write","error","server","cache","Cache","start","options","port","host","net","createServer","clientConnection","listen","req","command","keys","map","key","get","gets","delete","set","value","exptime","flags","add","replace","append","prepend","cas","uniqueCas","flush","JSON","stringify","stats"],"mappings":"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","sourceRoot":"/Users/esteban/node-memcached/server/src/","sourcesContent":["import net from 'net';\nimport Parser from './parser';\nimport Cache from './cache';\n\nconst DEFAULT_PORT = 11111;\nconst DEFAULT_HOST = 'localhost';\n\nconst parser = new Parser();\nexport default class Server {\n    constructor() {\n        this.server = null;\n        this.cache = new Cache();\n    }\n\n    start(options) {\n        this.port = options.port || DEFAULT_PORT;\n        this.host = options.host || DEFAULT_HOST;\n        this.server = net.createServer(this.clientConnection);\n        this.server.listen(this.port, this.host, () => {\n            console.log(`Server started on port ${this.port} at ${this.host}`);\n        });\n    }\n\n    clientConnection = (socket) => {\n        // Log when a client connnects.\n        console.log(`${socket.remoteAddress}:${socket.remotePort} Connected`);\n        // Listen for messages passed through the connection\n        socket.on('data', (data) => {\n            console.log(`${socket.remoteAddress}:${socket.remotePort} ${data} `);\n            // TODO: Here's where the magic happens.\n            try {\n                const responseArray = this.handleCommand(parser.translate(data));\n                responseArray.forEach((response) => {\n                    socket.write(`${response}\\r\\n`);\n                    socket.write('END\\r\\n');\n                });\n            } catch (error) {\n                console.error(`Internal server error, please debug: ${error}`);\n                socket.write('ERROR\\r\\n');\n            }\n        });\n        // Handle client connection termination.\n        socket.on('close', () => {\n            console.log(`${socket.remoteAddress}:${socket.remotePort} Terminated the connection`);\n        });\n        // Handle Client connection error.\n        socket.on('error', (error) => {\n            console.error(`${socket.remoteAddress}:${socket.remotePort} Connection Error ${error}`);\n        });\n    }\n\n    /**\n     * method router\n     * @param {object} request payload\n     * @returns {array}\n     */\n    handleCommand(req) {\n        if (req) {\n            switch (req.command) {\n            case 'get':\n                return req.keys.map((key) => this.cache.get(key));\n            case 'gets':\n                return req.keys.map((key) => this.cache.gets(key));\n            case 'delete':\n                return req.keys.map((key) => this.cache.delete(key));\n            case 'set':\n                return [this.cache.set(req.key, req.value, req.exptime, req.flags)];\n            case 'add':\n                return [this.cache.add(req.key, req.value, req.exptime, req.flags)];\n            case 'replace':\n                return [this.cache.replace(req.key, req.value, req.exptime, req.flags)];\n            case 'append':\n                return [this.cache.append(req.key, req.value)];\n            case 'prepend':\n                return [this.cache.prepend(req.key, req.value)];\n            case 'cas':\n                return [this.cache.cas(req.key, req.value, req.exptime, req.flags, req.uniqueCas)];\n            case 'flush':\n                return [this.cache.flush()];\n            case 'stats':\n                return [JSON.stringify(this.cache.stats())];\n            default:\n                return ['ERROR'];\n            }\n        } return ['CLIENT_ERROR'];\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6262b0c9b52f34c500fadeb20272ace8a9537aa1","contentHash":"c09b8b7b35660acb6ef57ec586a61697997862b02fbb7710fc3580212735f32b"},"/Users/esteban/node-memcached/server/src/parser.js":{"path":"/Users/esteban/node-memcached/server/src/parser.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":8,"column":14},"end":{"line":8,"column":57}},"3":{"start":{"line":10,"column":39},"end":{"line":10,"column":93}},"4":{"start":{"line":12,"column":44},"end":{"line":12,"column":195}},"5":{"start":{"line":12,"column":62},"end":{"line":12,"column":166}},"6":{"start":{"line":12,"column":176},"end":{"line":12,"column":193}},"7":{"start":{"line":12,"column":196},"end":{"line":12,"column":207}},"8":{"start":{"line":16,"column":4},"end":{"line":42,"column":7}},"9":{"start":{"line":17,"column":6},"end":{"line":38,"column":7}},"10":{"start":{"line":20,"column":12},"end":{"line":22,"column":10}},"11":{"start":{"line":24,"column":8},"end":{"line":30,"column":9}},"12":{"start":{"line":25,"column":28},"end":{"line":25,"column":61}},"13":{"start":{"line":25,"column":51},"end":{"line":25,"column":60}},"14":{"start":{"line":26,"column":10},"end":{"line":28,"column":14}},"15":{"start":{"line":29,"column":10},"end":{"line":29,"column":23}},"16":{"start":{"line":32,"column":8},"end":{"line":35,"column":9}},"17":{"start":{"line":33,"column":10},"end":{"line":33,"column":136}},"18":{"start":{"line":34,"column":10},"end":{"line":34,"column":23}},"19":{"start":{"line":37,"column":8},"end":{"line":37,"column":20}},"20":{"start":{"line":40,"column":6},"end":{"line":40,"column":65}},"21":{"start":{"line":41,"column":6},"end":{"line":41,"column":19}},"22":{"start":{"line":44,"column":4},"end":{"line":44,"column":24}},"23":{"start":{"line":45,"column":4},"end":{"line":45,"column":24}},"24":{"start":{"line":46,"column":4},"end":{"line":46,"column":19}},"25":{"start":{"line":47,"column":4},"end":{"line":47,"column":28}},"26":{"start":{"line":51,"column":37},"end":{"line":51,"column":75}},"27":{"start":{"line":52,"column":4},"end":{"line":52,"column":46}},"28":{"start":{"line":56,"column":18},"end":{"line":56,"column":49}},"29":{"start":{"line":57,"column":18},"end":{"line":57,"column":74}},"30":{"start":{"line":58,"column":20},"end":{"line":58,"column":28}},"31":{"start":{"line":60,"column":19},"end":{"line":60,"column":81}},"32":{"start":{"line":60,"column":49},"end":{"line":60,"column":80}},"33":{"start":{"line":62,"column":4},"end":{"line":101,"column":5}},"34":{"start":{"line":63,"column":20},"end":{"line":63,"column":22}},"35":{"start":{"line":65,"column":6},"end":{"line":98,"column":7}},"36":{"start":{"line":67,"column":10},"end":{"line":69,"column":12}},"37":{"start":{"line":70,"column":10},"end":{"line":70,"column":16}},"38":{"start":{"line":75,"column":10},"end":{"line":75,"column":29}},"39":{"start":{"line":76,"column":10},"end":{"line":79,"column":12}},"40":{"start":{"line":80,"column":10},"end":{"line":80,"column":16}},"41":{"start":{"line":83,"column":10},"end":{"line":91,"column":12}},"42":{"start":{"line":92,"column":10},"end":{"line":92,"column":16}},"43":{"start":{"line":95,"column":10},"end":{"line":97,"column":12}},"44":{"start":{"line":100,"column":6},"end":{"line":100,"column":57}},"45":{"start":{"line":100,"column":42},"end":{"line":100,"column":57}},"46":{"start":{"line":103,"column":4},"end":{"line":103,"column":17}},"47":{"start":{"line":108,"column":0},"end":{"line":108,"column":25}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":31}},"loc":{"start":{"line":10,"column":37},"end":{"line":10,"column":95}},"line":10},"1":{"name":"_defineProperty","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":24}},"loc":{"start":{"line":12,"column":42},"end":{"line":12,"column":209}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":2},"end":{"line":15,"column":3}},"loc":{"start":{"line":15,"column":16},"end":{"line":48,"column":3}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":16,"column":38},"end":{"line":16,"column":39}},"loc":{"start":{"line":16,"column":59},"end":{"line":42,"column":5}},"line":16},"4":{"name":"(anonymous_4)","decl":{"start":{"line":25,"column":46},"end":{"line":25,"column":47}},"loc":{"start":{"line":25,"column":51},"end":{"line":25,"column":60}},"line":25},"5":{"name":"(anonymous_5)","decl":{"start":{"line":50,"column":2},"end":{"line":50,"column":3}},"loc":{"start":{"line":50,"column":21},"end":{"line":53,"column":3}},"line":50},"6":{"name":"(anonymous_6)","decl":{"start":{"line":55,"column":2},"end":{"line":55,"column":3}},"loc":{"start":{"line":55,"column":32},"end":{"line":104,"column":3}},"line":55},"7":{"name":"(anonymous_7)","decl":{"start":{"line":60,"column":40},"end":{"line":60,"column":41}},"loc":{"start":{"line":60,"column":49},"end":{"line":60,"column":80}},"line":60}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":46},"end":{"line":10,"column":92}},"type":"cond-expr","locations":[{"start":{"line":10,"column":70},"end":{"line":10,"column":73}},{"start":{"line":10,"column":76},"end":{"line":10,"column":92}}],"line":10},"1":{"loc":{"start":{"line":10,"column":46},"end":{"line":10,"column":67}},"type":"binary-expr","locations":[{"start":{"line":10,"column":46},"end":{"line":10,"column":49}},{"start":{"line":10,"column":53},"end":{"line":10,"column":67}}],"line":10},"2":{"loc":{"start":{"line":12,"column":44},"end":{"line":12,"column":195}},"type":"if","locations":[{"start":{"line":12,"column":44},"end":{"line":12,"column":195}},{"start":{"line":12,"column":44},"end":{"line":12,"column":195}}],"line":12},"3":{"loc":{"start":{"line":17,"column":6},"end":{"line":38,"column":7}},"type":"if","locations":[{"start":{"line":17,"column":6},"end":{"line":38,"column":7}},{"start":{"line":17,"column":6},"end":{"line":38,"column":7}}],"line":17},"4":{"loc":{"start":{"line":24,"column":8},"end":{"line":30,"column":9}},"type":"if","locations":[{"start":{"line":24,"column":8},"end":{"line":30,"column":9}},{"start":{"line":24,"column":8},"end":{"line":30,"column":9}}],"line":24},"5":{"loc":{"start":{"line":32,"column":8},"end":{"line":35,"column":9}},"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":35,"column":9}},{"start":{"line":32,"column":8},"end":{"line":35,"column":9}}],"line":32},"6":{"loc":{"start":{"line":32,"column":12},"end":{"line":32,"column":104}},"type":"binary-expr","locations":[{"start":{"line":32,"column":12},"end":{"line":32,"column":25}},{"start":{"line":32,"column":29},"end":{"line":32,"column":42}},{"start":{"line":32,"column":46},"end":{"line":32,"column":104}}],"line":32},"7":{"loc":{"start":{"line":57,"column":18},"end":{"line":57,"column":74}},"type":"cond-expr","locations":[{"start":{"line":57,"column":53},"end":{"line":57,"column":69}},{"start":{"line":57,"column":72},"end":{"line":57,"column":74}}],"line":57},"8":{"loc":{"start":{"line":62,"column":4},"end":{"line":101,"column":5}},"type":"if","locations":[{"start":{"line":62,"column":4},"end":{"line":101,"column":5}},{"start":{"line":62,"column":4},"end":{"line":101,"column":5}}],"line":62},"9":{"loc":{"start":{"line":65,"column":6},"end":{"line":98,"column":7}},"type":"switch","locations":[{"start":{"line":66,"column":8},"end":{"line":70,"column":16}},{"start":{"line":72,"column":8},"end":{"line":72,"column":25}},{"start":{"line":73,"column":8},"end":{"line":73,"column":24}},{"start":{"line":74,"column":8},"end":{"line":80,"column":16}},{"start":{"line":82,"column":8},"end":{"line":92,"column":16}},{"start":{"line":94,"column":8},"end":{"line":97,"column":12}}],"line":65},"10":{"loc":{"start":{"line":89,"column":23},"end":{"line":89,"column":47}},"type":"cond-expr","locations":[{"start":{"line":89,"column":34},"end":{"line":89,"column":42}},{"start":{"line":89,"column":45},"end":{"line":89,"column":47}}],"line":89},"11":{"loc":{"start":{"line":100,"column":6},"end":{"line":100,"column":57}},"type":"if","locations":[{"start":{"line":100,"column":6},"end":{"line":100,"column":57}},{"start":{"line":100,"column":6},"end":{"line":100,"column":57}}],"line":100}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":1,"7":1,"8":1,"9":19,"10":19,"11":19,"12":0,"13":0,"14":0,"15":0,"16":19,"17":0,"18":0,"19":19,"20":0,"21":0,"22":1,"23":1,"24":1,"25":1,"26":19,"27":19,"28":19,"29":19,"30":19,"31":19,"32":30,"33":19,"34":19,"35":19,"36":0,"37":0,"38":10,"39":10,"40":10,"41":9,"42":9,"43":0,"44":19,"45":19,"46":0,"47":1},"f":{"0":1,"1":1,"2":1,"3":19,"4":0,"5":19,"6":19,"7":30},"b":{"0":[1,0],"1":[1,1],"2":[0,1],"3":[19,0],"4":[0,19],"5":[0,19],"6":[19,9,9],"7":[19,0],"8":[19,0],"9":[0,9,10,10,9,0],"10":[1,8],"11":[19,0]},"inputSourceMap":{"version":3,"sources":["parser.js"],"names":["Parser","constructor","request","schema","error","protocol","validate","abortEarly","errorList","details","map","x","message","console","JSON","stringify","errors","value","bytes","parseInt","length","command","options","data","bytesRemaining","translate","commandLine","dataBlock","toString","split","parse","words","trim","Models","find","model","methods","includes","group","splice","keys","key","flags","exptime","uniqueCas"],"mappings":"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","sourceRoot":"/Users/esteban/node-memcached/server/src/","sourcesContent":["import Models from './models';\n\nexport default class Parser {\n    constructor() {\n        this.command = null;\n        this.options = null;\n        this.data = '';\n        this.bytesRemaining = 0;\n    }\n\n    translate(message) {\n        const [commandLine, dataBlock] = message.toString('utf8').split('\\r\\n');\n        return this.parse(commandLine, dataBlock);\n    }\n\n    parse(commandLine, dataBlock) {\n        const words = commandLine.trim().split(/\\s+/);\n        const value = typeof dataBlock !== 'undefined' ? dataBlock.trim() : '';\n        const command = words[0];\n        const schema = Models.find((model) => model.methods.includes(command));\n        if (schema) {\n            let request = {};\n            switch (schema.group) {\n            case 'flush':\n                request = { command };\n                break;\n            case 'retrieval':\n            case 'deletion':\n            default:\n                words.splice(0, 1);\n                request = { command, keys: words };\n                break;\n            case 'storage':\n                request = {\n                    command, key: words[1], flags: words[2], exptime: words[3], bytes: words[4], uniqueCas: (words[5] ? words[5] : ''), value,\n                };\n                break;\n            case 'statistics':\n                request = { command };\n            }\n            if (this.validate(request, schema)) return request;\n        }\n        return false;\n    }\n\n    validate = (request, schema) => {\n        if (schema) {\n            const { error } = schema.protocol.validate(request, { abortEarly: false });\n            if (error) {\n                const errorList = error.details.map((x) => x.message);\n                console.error(JSON.stringify({ errors: errorList }));\n                return false;\n            }\n            if (request.value && request.bytes && parseInt(request.value.length) !== parseInt(request.bytes)) {\n                console.error(`Bytes parameter passed: ${request.bytes} not compatible with actual value of length: ${request.value.length}`);\n                return false;\n            }\n            return true;\n        }\n        console.error(`Command not supported: ${request.command}`);\n        return false;\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b0c6a59ec1024a8b6586ccb0332a1540c08048d0","contentHash":"918d037b43b0b9da1cad23042e930ad1b08d63524d0cfb891b8fa39a4afbbcb4"},"/Users/esteban/node-memcached/server/src/models.js":{"path":"/Users/esteban/node-memcached/server/src/models.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":8,"column":11},"end":{"line":8,"column":49}},"3":{"start":{"line":10,"column":39},"end":{"line":10,"column":93}},"4":{"start":{"line":12,"column":15},"end":{"line":50,"column":2}},"5":{"start":{"line":51,"column":15},"end":{"line":51,"column":21}},"6":{"start":{"line":52,"column":0},"end":{"line":52,"column":27}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":31}},"loc":{"start":{"line":10,"column":37},"end":{"line":10,"column":95}},"line":10}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":46},"end":{"line":10,"column":92}},"type":"cond-expr","locations":[{"start":{"line":10,"column":70},"end":{"line":10,"column":73}},{"start":{"line":10,"column":76},"end":{"line":10,"column":92}}],"line":10},"1":{"loc":{"start":{"line":10,"column":46},"end":{"line":10,"column":67}},"type":"binary-expr","locations":[{"start":{"line":10,"column":46},"end":{"line":10,"column":49}},{"start":{"line":10,"column":53},"end":{"line":10,"column":67}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"f":{"0":1},"b":{"0":[0,1],"1":[1,1]},"inputSourceMap":{"version":3,"sources":["models.js"],"names":["Models","group","methods","protocol","Joi","object","command","string","required","keys","array","key","flags","number","exptime","default","bytes","value","allow","uniqueCas","items"],"mappings":";;;;;;;AAAA;;;;AAEA,MAAMA,MAAM,GAAG,CACX;AACIC,EAAAA,KAAK,EAAE,WADX;AAEIC,EAAAA,OAAO,EAAE,CACL,KADK,EAEL,MAFK,CAFb;AAMIC,EAAAA,QAAQ,EAAEC,aAAIC,MAAJ,CAAW;AACjBC,IAAAA,OAAO,EAAEF,aAAIG,MAAJ,GAAaC,QAAb,EADQ;AAEjBC,IAAAA,IAAI,EAAEL,aAAIM,KAAJ,GAAYF,QAAZ;AAFW,GAAX;AANd,CADW,EAYX;AACIP,EAAAA,KAAK,EAAE,SADX;AAEIC,EAAAA,OAAO,EAAE,CACL,KADK,EAEL,KAFK,EAGL,SAHK,EAIL,QAJK,EAKL,SALK,EAML,KANK,CAFb;AAUIC,EAAAA,QAAQ,EAAEC,aAAIC,MAAJ,CAAW;AACjBC,IAAAA,OAAO,EAAEF,aAAIG,MAAJ,GAAaC,QAAb,EADQ;AAEjBG,IAAAA,GAAG,EAAEP,aAAIG,MAAJ,GAAaC,QAAb,EAFY;AAGjBI,IAAAA,KAAK,EAAER,aAAIS,MAAJ,GAAaL,QAAb,EAHU;AAIjBM,IAAAA,OAAO,EAAEV,aAAIS,MAAJ,GAAaL,QAAb,GAAwBO,OAAxB,CAAgC,EAAhC,CAJQ;AAKjBC,IAAAA,KAAK,EAAEZ,aAAIS,MAAJ,GAAaL,QAAb,EALU;AAMjBS,IAAAA,KAAK,EAAEb,aAAIG,MAAJ,GAAaC,QAAb,GAAwBU,KAAxB,CAA8B,EAA9B,CANU;AAOjBC,IAAAA,SAAS,EAAEf,aAAIS,MAAJ,GAAaK,KAAb,CAAmB,EAAnB;AAPM,GAAX;AAVd,CAZW,EAgCX;AACIjB,EAAAA,KAAK,EAAE,UADX;AAEIC,EAAAA,OAAO,EAAE,CAAC,QAAD,CAFb;AAGIC,EAAAA,QAAQ,EAAEC,aAAIC,MAAJ,CAAW;AACjBC,IAAAA,OAAO,EAAEF,aAAIG,MAAJ,GAAaC,QAAb,EADQ;AAEjBC,IAAAA,IAAI,EAAEL,aAAIM,KAAJ,GAAYU,KAAZ,CAAkBhB,aAAIG,MAAJ,EAAlB,EAAgCC,QAAhC;AAFW,GAAX;AAHd,CAhCW,EAwCX;AACIP,EAAAA,KAAK,EAAE,OADX;AAEIC,EAAAA,OAAO,EAAE,CAAC,OAAD,CAFb;AAGIC,EAAAA,QAAQ,EAAEC,aAAIC,MAAJ,CAAW;AACjBC,IAAAA,OAAO,EAAEF,aAAIG,MAAJ,GAAaC,QAAb;AADQ,GAAX;AAHd,CAxCW,EA+CX;AACIP,EAAAA,KAAK,EAAE,YADX;AAEIC,EAAAA,OAAO,EAAE,CAAC,OAAD,CAFb;AAGIC,EAAAA,QAAQ,EAAEC,aAAIC,MAAJ,CAAW;AACjBC,IAAAA,OAAO,EAAEF,aAAIG,MAAJ,GAAaC,QAAb;AADQ,GAAX;AAHd,CA/CW,CAAf;eAwDeR,M","sourceRoot":"/Users/esteban/node-memcached/server/src/","sourcesContent":["import Joi from 'joi';\n\nconst Models = [\n    {\n        group: 'retrieval',\n        methods: [\n            'get',\n            'gets',\n        ],\n        protocol: Joi.object({\n            command: Joi.string().required(),\n            keys: Joi.array().required(),\n        }),\n    },\n    {\n        group: 'storage',\n        methods: [\n            'set',\n            'add',\n            'replace',\n            'append',\n            'prepend',\n            'cas',\n        ],\n        protocol: Joi.object({\n            command: Joi.string().required(),\n            key: Joi.string().required(),\n            flags: Joi.number().required(),\n            exptime: Joi.number().required().default(60),\n            bytes: Joi.number().required(),\n            value: Joi.string().required().allow(''),\n            uniqueCas: Joi.number().allow(''),\n        }),\n    },\n    {\n        group: 'deletion',\n        methods: ['delete'],\n        protocol: Joi.object({\n            command: Joi.string().required(),\n            keys: Joi.array().items(Joi.string()).required(),\n        }),\n    },\n    {\n        group: 'flush',\n        methods: ['flush'],\n        protocol: Joi.object({\n            command: Joi.string().required(),\n        }),\n    },\n    {\n        group: 'statistics',\n        methods: ['stats'],\n        protocol: Joi.object({\n            command: Joi.string().required(),\n        }),\n    },\n];\n\nexport default Models;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d5929775a3d5ba3b26134213b901e76e66a85cd2","contentHash":"befd0910ca9732701c92170c006f04aecbde97e36fa59aa74dede7d0d7ea1ee2"},"/Users/esteban/node-memcached/server/src/cache.js":{"path":"/Users/esteban/node-memcached/server/src/cache.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":8,"column":14},"end":{"line":8,"column":57}},"3":{"start":{"line":10,"column":39},"end":{"line":10,"column":93}},"4":{"start":{"line":15,"column":4},"end":{"line":15,"column":29}},"5":{"start":{"line":16,"column":4},"end":{"line":16,"column":48}},"6":{"start":{"line":17,"column":4},"end":{"line":17,"column":24}},"7":{"start":{"line":18,"column":4},"end":{"line":18,"column":49}},"8":{"start":{"line":19,"column":4},"end":{"line":19,"column":26}},"9":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"10":{"start":{"line":24,"column":6},"end":{"line":24,"column":19}},"11":{"start":{"line":27,"column":19},"end":{"line":27,"column":40}},"12":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"13":{"start":{"line":30,"column":6},"end":{"line":30,"column":19}},"14":{"start":{"line":33,"column":4},"end":{"line":33,"column":16}},"15":{"start":{"line":38,"column":4},"end":{"line":38,"column":42}},"16":{"start":{"line":38,"column":29},"end":{"line":38,"column":42}},"17":{"start":{"line":39,"column":19},"end":{"line":39,"column":40}},"18":{"start":{"line":40,"column":4},"end":{"line":40,"column":78}},"19":{"start":{"line":45,"column":4},"end":{"line":45,"column":42}},"20":{"start":{"line":45,"column":29},"end":{"line":45,"column":42}},"21":{"start":{"line":46,"column":19},"end":{"line":46,"column":40}},"22":{"start":{"line":47,"column":4},"end":{"line":47,"column":98}},"23":{"start":{"line":52,"column":19},"end":{"line":52,"column":61}},"24":{"start":{"line":53,"column":4},"end":{"line":53,"column":34}},"25":{"start":{"line":54,"column":4},"end":{"line":54,"column":41}},"26":{"start":{"line":54,"column":27},"end":{"line":54,"column":39}},"27":{"start":{"line":55,"column":4},"end":{"line":55,"column":20}},"28":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"29":{"start":{"line":61,"column":6},"end":{"line":61,"column":50}},"30":{"start":{"line":64,"column":4},"end":{"line":64,"column":24}},"31":{"start":{"line":69,"column":4},"end":{"line":72,"column":5}},"32":{"start":{"line":70,"column":6},"end":{"line":70,"column":40}},"33":{"start":{"line":71,"column":6},"end":{"line":71,"column":50}},"34":{"start":{"line":74,"column":4},"end":{"line":74,"column":24}},"35":{"start":{"line":79,"column":4},"end":{"line":83,"column":5}},"36":{"start":{"line":80,"column":21},"end":{"line":80,"column":42}},"37":{"start":{"line":81,"column":23},"end":{"line":81,"column":48}},"38":{"start":{"line":82,"column":6},"end":{"line":82,"column":67}},"39":{"start":{"line":85,"column":4},"end":{"line":85,"column":24}},"40":{"start":{"line":90,"column":4},"end":{"line":94,"column":5}},"41":{"start":{"line":91,"column":21},"end":{"line":91,"column":42}},"42":{"start":{"line":92,"column":23},"end":{"line":92,"column":48}},"43":{"start":{"line":93,"column":6},"end":{"line":93,"column":67}},"44":{"start":{"line":96,"column":4},"end":{"line":96,"column":24}},"45":{"start":{"line":100,"column":26},"end":{"line":100,"column":47}},"46":{"start":{"line":102,"column":4},"end":{"line":108,"column":5}},"47":{"start":{"line":103,"column":6},"end":{"line":105,"column":7}},"48":{"start":{"line":104,"column":8},"end":{"line":104,"column":52}},"49":{"start":{"line":107,"column":6},"end":{"line":107,"column":22}},"50":{"start":{"line":110,"column":4},"end":{"line":110,"column":23}},"51":{"start":{"line":114,"column":4},"end":{"line":116,"column":5}},"52":{"start":{"line":115,"column":6},"end":{"line":115,"column":25}},"53":{"start":{"line":118,"column":4},"end":{"line":118,"column":29}},"54":{"start":{"line":119,"column":4},"end":{"line":119,"column":41}},"55":{"start":{"line":119,"column":27},"end":{"line":119,"column":39}},"56":{"start":{"line":120,"column":4},"end":{"line":120,"column":42}},"57":{"start":{"line":121,"column":4},"end":{"line":121,"column":21}},"58":{"start":{"line":125,"column":4},"end":{"line":125,"column":25}},"59":{"start":{"line":126,"column":4},"end":{"line":126,"column":41}},"60":{"start":{"line":126,"column":27},"end":{"line":126,"column":39}},"61":{"start":{"line":127,"column":4},"end":{"line":127,"column":39}},"62":{"start":{"line":128,"column":4},"end":{"line":128,"column":23}},"63":{"start":{"line":132,"column":4},"end":{"line":134,"column":5}},"64":{"start":{"line":133,"column":6},"end":{"line":133,"column":26}},"65":{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},"66":{"start":{"line":137,"column":6},"end":{"line":137,"column":25}},"67":{"start":{"line":142,"column":4},"end":{"line":142,"column":42}},"68":{"start":{"line":144,"column":4},"end":{"line":146,"column":5}},"69":{"start":{"line":145,"column":6},"end":{"line":145,"column":13}},"70":{"start":{"line":148,"column":4},"end":{"line":151,"column":5}},"71":{"start":{"line":149,"column":6},"end":{"line":149,"column":31}},"72":{"start":{"line":150,"column":6},"end":{"line":150,"column":54}},"73":{"start":{"line":150,"column":47},"end":{"line":150,"column":54}},"74":{"start":{"line":155,"column":4},"end":{"line":155,"column":62}},"75":{"start":{"line":157,"column":4},"end":{"line":159,"column":5}},"76":{"start":{"line":158,"column":6},"end":{"line":158,"column":13}},"77":{"start":{"line":161,"column":4},"end":{"line":161,"column":85}},"78":{"start":{"line":163,"column":4},"end":{"line":167,"column":5}},"79":{"start":{"line":164,"column":6},"end":{"line":166,"column":7}},"80":{"start":{"line":165,"column":8},"end":{"line":165,"column":33}},"81":{"start":{"line":169,"column":4},"end":{"line":171,"column":5}},"82":{"start":{"line":170,"column":6},"end":{"line":170,"column":13}},"83":{"start":{"line":173,"column":4},"end":{"line":176,"column":5}},"84":{"start":{"line":174,"column":6},"end":{"line":174,"column":31}},"85":{"start":{"line":175,"column":6},"end":{"line":175,"column":53}},"86":{"start":{"line":175,"column":46},"end":{"line":175,"column":53}},"87":{"start":{"line":180,"column":4},"end":{"line":180,"column":62}},"88":{"start":{"line":181,"column":4},"end":{"line":186,"column":6}},"89":{"start":{"line":191,"column":0},"end":{"line":191,"column":24}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":31}},"loc":{"start":{"line":10,"column":37},"end":{"line":10,"column":95}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":2},"end":{"line":14,"column":3}},"loc":{"start":{"line":14,"column":28},"end":{"line":20,"column":3}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":2},"end":{"line":22,"column":3}},"loc":{"start":{"line":22,"column":16},"end":{"line":34,"column":3}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":36,"column":2},"end":{"line":36,"column":3}},"loc":{"start":{"line":36,"column":11},"end":{"line":41,"column":3}},"line":36},"4":{"name":"(anonymous_4)","decl":{"start":{"line":43,"column":2},"end":{"line":43,"column":3}},"loc":{"start":{"line":43,"column":12},"end":{"line":48,"column":3}},"line":43},"5":{"name":"(anonymous_5)","decl":{"start":{"line":50,"column":2},"end":{"line":50,"column":3}},"loc":{"start":{"line":50,"column":34},"end":{"line":56,"column":3}},"line":50},"6":{"name":"(anonymous_6)","decl":{"start":{"line":54,"column":21},"end":{"line":54,"column":22}},"loc":{"start":{"line":54,"column":27},"end":{"line":54,"column":39}},"line":54},"7":{"name":"(anonymous_7)","decl":{"start":{"line":58,"column":2},"end":{"line":58,"column":3}},"loc":{"start":{"line":58,"column":34},"end":{"line":65,"column":3}},"line":58},"8":{"name":"(anonymous_8)","decl":{"start":{"line":67,"column":2},"end":{"line":67,"column":3}},"loc":{"start":{"line":67,"column":38},"end":{"line":75,"column":3}},"line":67},"9":{"name":"(anonymous_9)","decl":{"start":{"line":77,"column":2},"end":{"line":77,"column":3}},"loc":{"start":{"line":77,"column":21},"end":{"line":86,"column":3}},"line":77},"10":{"name":"(anonymous_10)","decl":{"start":{"line":88,"column":2},"end":{"line":88,"column":3}},"loc":{"start":{"line":88,"column":22},"end":{"line":97,"column":3}},"line":88},"11":{"name":"(anonymous_11)","decl":{"start":{"line":99,"column":2},"end":{"line":99,"column":3}},"loc":{"start":{"line":99,"column":45},"end":{"line":111,"column":3}},"line":99},"12":{"name":"(anonymous_12)","decl":{"start":{"line":113,"column":2},"end":{"line":113,"column":3}},"loc":{"start":{"line":113,"column":14},"end":{"line":122,"column":3}},"line":113},"13":{"name":"(anonymous_13)","decl":{"start":{"line":119,"column":21},"end":{"line":119,"column":22}},"loc":{"start":{"line":119,"column":27},"end":{"line":119,"column":39}},"line":119},"14":{"name":"(anonymous_14)","decl":{"start":{"line":124,"column":2},"end":{"line":124,"column":3}},"loc":{"start":{"line":124,"column":10},"end":{"line":129,"column":3}},"line":124},"15":{"name":"(anonymous_15)","decl":{"start":{"line":126,"column":21},"end":{"line":126,"column":22}},"loc":{"start":{"line":126,"column":27},"end":{"line":126,"column":39}},"line":126},"16":{"name":"(anonymous_16)","decl":{"start":{"line":131,"column":2},"end":{"line":131,"column":3}},"loc":{"start":{"line":131,"column":10},"end":{"line":139,"column":3}},"line":131},"17":{"name":"(anonymous_17)","decl":{"start":{"line":141,"column":2},"end":{"line":141,"column":3}},"loc":{"start":{"line":141,"column":17},"end":{"line":152,"column":3}},"line":141},"18":{"name":"(anonymous_18)","decl":{"start":{"line":154,"column":2},"end":{"line":154,"column":3}},"loc":{"start":{"line":154,"column":16},"end":{"line":177,"column":3}},"line":154},"19":{"name":"(anonymous_19)","decl":{"start":{"line":179,"column":2},"end":{"line":179,"column":3}},"loc":{"start":{"line":179,"column":10},"end":{"line":187,"column":3}},"line":179}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":46},"end":{"line":10,"column":92}},"type":"cond-expr","locations":[{"start":{"line":10,"column":70},"end":{"line":10,"column":73}},{"start":{"line":10,"column":76},"end":{"line":10,"column":92}}],"line":10},"1":{"loc":{"start":{"line":10,"column":46},"end":{"line":10,"column":67}},"type":"binary-expr","locations":[{"start":{"line":10,"column":46},"end":{"line":10,"column":49}},{"start":{"line":10,"column":53},"end":{"line":10,"column":67}}],"line":10},"2":{"loc":{"start":{"line":14,"column":14},"end":{"line":14,"column":26}},"type":"default-arg","locations":[{"start":{"line":14,"column":24},"end":{"line":14,"column":26}}],"line":14},"3":{"loc":{"start":{"line":16,"column":23},"end":{"line":16,"column":47}},"type":"binary-expr","locations":[{"start":{"line":16,"column":23},"end":{"line":16,"column":40}},{"start":{"line":16,"column":44},"end":{"line":16,"column":47}}],"line":16},"4":{"loc":{"start":{"line":18,"column":22},"end":{"line":18,"column":48}},"type":"binary-expr","locations":[{"start":{"line":18,"column":22},"end":{"line":18,"column":40}},{"start":{"line":18,"column":44},"end":{"line":18,"column":48}}],"line":18},"5":{"loc":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},{"start":{"line":23,"column":4},"end":{"line":25,"column":5}}],"line":23},"6":{"loc":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},{"start":{"line":29,"column":4},"end":{"line":31,"column":5}}],"line":29},"7":{"loc":{"start":{"line":38,"column":4},"end":{"line":38,"column":42}},"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":38,"column":42}},{"start":{"line":38,"column":4},"end":{"line":38,"column":42}}],"line":38},"8":{"loc":{"start":{"line":45,"column":4},"end":{"line":45,"column":42}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":45,"column":42}},{"start":{"line":45,"column":4},"end":{"line":45,"column":42}}],"line":45},"9":{"loc":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},{"start":{"line":60,"column":4},"end":{"line":62,"column":5}}],"line":60},"10":{"loc":{"start":{"line":69,"column":4},"end":{"line":72,"column":5}},"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":72,"column":5}},{"start":{"line":69,"column":4},"end":{"line":72,"column":5}}],"line":69},"11":{"loc":{"start":{"line":79,"column":4},"end":{"line":83,"column":5}},"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":83,"column":5}},{"start":{"line":79,"column":4},"end":{"line":83,"column":5}}],"line":79},"12":{"loc":{"start":{"line":90,"column":4},"end":{"line":94,"column":5}},"type":"if","locations":[{"start":{"line":90,"column":4},"end":{"line":94,"column":5}},{"start":{"line":90,"column":4},"end":{"line":94,"column":5}}],"line":90},"13":{"loc":{"start":{"line":102,"column":4},"end":{"line":108,"column":5}},"type":"if","locations":[{"start":{"line":102,"column":4},"end":{"line":108,"column":5}},{"start":{"line":102,"column":4},"end":{"line":108,"column":5}}],"line":102},"14":{"loc":{"start":{"line":103,"column":6},"end":{"line":105,"column":7}},"type":"if","locations":[{"start":{"line":103,"column":6},"end":{"line":105,"column":7}},{"start":{"line":103,"column":6},"end":{"line":105,"column":7}}],"line":103},"15":{"loc":{"start":{"line":114,"column":4},"end":{"line":116,"column":5}},"type":"if","locations":[{"start":{"line":114,"column":4},"end":{"line":116,"column":5}},{"start":{"line":114,"column":4},"end":{"line":116,"column":5}}],"line":114},"16":{"loc":{"start":{"line":132,"column":4},"end":{"line":134,"column":5}},"type":"if","locations":[{"start":{"line":132,"column":4},"end":{"line":134,"column":5}},{"start":{"line":132,"column":4},"end":{"line":134,"column":5}}],"line":132},"17":{"loc":{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},"type":"if","locations":[{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},{"start":{"line":136,"column":4},"end":{"line":138,"column":5}}],"line":136},"18":{"loc":{"start":{"line":144,"column":4},"end":{"line":146,"column":5}},"type":"if","locations":[{"start":{"line":144,"column":4},"end":{"line":146,"column":5}},{"start":{"line":144,"column":4},"end":{"line":146,"column":5}}],"line":144},"19":{"loc":{"start":{"line":150,"column":6},"end":{"line":150,"column":54}},"type":"if","locations":[{"start":{"line":150,"column":6},"end":{"line":150,"column":54}},{"start":{"line":150,"column":6},"end":{"line":150,"column":54}}],"line":150},"20":{"loc":{"start":{"line":157,"column":4},"end":{"line":159,"column":5}},"type":"if","locations":[{"start":{"line":157,"column":4},"end":{"line":159,"column":5}},{"start":{"line":157,"column":4},"end":{"line":159,"column":5}}],"line":157},"21":{"loc":{"start":{"line":164,"column":6},"end":{"line":166,"column":7}},"type":"if","locations":[{"start":{"line":164,"column":6},"end":{"line":166,"column":7}},{"start":{"line":164,"column":6},"end":{"line":166,"column":7}}],"line":164},"22":{"loc":{"start":{"line":169,"column":4},"end":{"line":171,"column":5}},"type":"if","locations":[{"start":{"line":169,"column":4},"end":{"line":171,"column":5}},{"start":{"line":169,"column":4},"end":{"line":171,"column":5}}],"line":169},"23":{"loc":{"start":{"line":175,"column":6},"end":{"line":175,"column":53}},"type":"if","locations":[{"start":{"line":175,"column":6},"end":{"line":175,"column":53}},{"start":{"line":175,"column":6},"end":{"line":175,"column":53}}],"line":175}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":15,"10":2,"11":13,"12":13,"13":0,"14":13,"15":8,"16":1,"17":7,"18":7,"19":1,"20":0,"21":1,"22":1,"23":9,"24":9,"25":9,"26":9,"27":9,"28":1,"29":1,"30":0,"31":1,"32":1,"33":1,"34":0,"35":1,"36":1,"37":1,"38":1,"39":0,"40":1,"41":1,"42":1,"43":1,"44":0,"45":1,"46":1,"47":1,"48":1,"49":0,"50":0,"51":1,"52":0,"53":1,"54":1,"55":1,"56":1,"57":1,"58":0,"59":0,"60":0,"61":0,"62":0,"63":10,"64":10,"65":10,"66":0,"67":10,"68":10,"69":10,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":1},"f":{"0":1,"1":1,"2":15,"3":8,"4":1,"5":9,"6":9,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":0,"15":0,"16":10,"17":10,"18":0,"19":0},"b":{"0":[1,0],"1":[1,1],"2":[1],"3":[1,1],"4":[1,1],"5":[2,13],"6":[0,13],"7":[1,7],"8":[0,1],"9":[1,0],"10":[1,0],"11":[1,0],"12":[1,0],"13":[1,0],"14":[1,0],"15":[0,1],"16":[10,0],"17":[0,10],"18":[10,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0]},"inputSourceMap":{"version":3,"sources":["cache.js"],"names":["Cache","constructor","options","records","Map","maxMemoryMB","maxMemory","usedMemory","maxRecords","totalRecords","contains","key","has","record","get","isValid","flags","length","value","gets","uniqueCas","set","exptime","Record","process","nextTick","purge","add","replace","append","newValue","prepend","cas","currentRecord","parseInt","delete","size","flush","clear","console","log","purgeRecords","maxSizeMb","purgeMemory","keys","memoryUsage","rss","info","stats","MemoryUsage","TotalRecords","MaxMemoryMB"],"mappings":"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","sourceRoot":"/Users/esteban/node-memcached/server/src/","sourcesContent":["/* eslint-disable guard-for-in */\nimport Record from './record';\n\nexport default class Cache {\n    constructor(options = {}) {\n        this.records = new Map();\n        this.maxMemoryMB = options.maxMemory || 100;\n        this.usedMemory = 0;\n        this.maxRecords = options.maxRecords || 5000;\n        this.totalRecords = 0;\n    }\n\n    contains(key) {\n        if (!this.records.has(key)) {\n            return false;\n        }\n        const record = this.records.get(key);\n        if (!record.isValid()) {\n            return false;\n        }\n        return true;\n    }\n\n    get(key) {\n        // console.debug('Enter get function');\n        if (!this.contains(key)) return 'END';\n        const record = this.records.get(key);\n        return `VALUE ${key} ${record.flags} ${record.length}\\r\\n${record.value}`;\n    }\n\n    gets(key) {\n        // console.debug('Enter get function');\n        if (!this.contains(key)) return 'END';\n        const record = this.records.get(key);\n        return `VALUE ${key} ${record.flags} ${record.length} ${record.uniqueCas}\\r\\n${record.value}`;\n    }\n\n    set(key, value, exptime, flags) {\n        // console.debug('Enter set function');\n        const record = new Record(value, exptime, flags);\n        this.records.set(key, record);\n        process.nextTick(() => this.purge());\n        return 'STORED';\n    }\n\n    add(key, value, exptime, flags) {\n        // console.debug('Enter add function');\n        if (!this.contains(key)) {\n            return this.set(key, value, exptime, flags);\n        } return 'NOT_STORED';\n    }\n\n    replace(key, value, exptime, flags) {\n        // console.debug('Enter replace function');\n        if (this.contains(key)) {\n            this.records.get(key).uniqueCas++;\n            return this.set(key, value, exptime, flags);\n        } return 'NOT_STORED';\n    }\n\n    append(key, value) {\n        // console.debug('Enter append function');\n        if (this.contains(key)) {\n            const record = this.records.get(key);\n            const newValue = `${record.value}${value}`;\n            return this.set(key, newValue, record.exptime, record.flags);\n        } return 'NOT_STORED';\n    }\n\n    prepend(key, value) {\n        // console.debug('Enter prepend function');\n        if (this.contains(key)) {\n            const record = this.records.get(key);\n            const newValue = `${value}${record.value}`;\n            return this.set(key, newValue, record.exptime, record.flags);\n        } return 'NOT_STORED';\n    }\n\n    cas(key, value, exptime, flags, uniqueCas) {\n        const currentRecord = this.records.get(key);\n        if (this.contains(key)) {\n            if (currentRecord.uniqueCas === parseInt(uniqueCas)) {\n                return this.set(key, value, exptime, flags);\n            } return 'EXISTS';\n        } return 'NOT_FOUND';\n    }\n\n    delete(key) {\n        if (!this.contains(key)) {\n            return 'NOT_FOUND';\n        }\n        this.records.delete(key);\n        process.nextTick(() => this.purge());\n        this.totalRecords = this.records.size;\n        return 'DELETED';\n    }\n\n    flush() {\n        this.records.clear();\n        process.nextTick(() => this.purge());\n        console.log('All records flushed');\n        return 'FLUSH_ALL';\n    }\n\n    purge() {\n        if (this.maxRecords) {\n            this.purgeRecords();\n        }\n        if (this.maxSizeMb) {\n            this.purgeMemory();\n        }\n    }\n\n    purgeRecords() {\n        this.totalRecords = this.records.size;\n        if (this.records.size < this.maxRecords) {\n            return;\n        }\n        for (const key in this.records.keys()) {\n            this.records.delete(key);\n            if (this.records.size < this.maxRecords) return;\n        }\n    }\n\n    purgeMemory() {\n        this.usedMemory = process.memoryUsage().rss / 1024 / 1024;\n        if (this.usedMemory < this.maxMemoryMB) {\n            return;\n        }\n        console.info('Memory used %s, max %s: purging', this.usedMemory, this.maxSizeMb);\n        for (const key in this.records.keys()) {\n            if (!this.records.get(key).isValid()) {\n                this.records.delete(key);\n            }\n        }\n        if (this.usedMemory < this.maxMemoryMB) {\n            return;\n        }\n        for (const key in this.records) {\n            this.records.delete(key);\n            if (this.usedMemory < this.maxMemoryMB) return;\n        }\n    }\n\n    stats() {\n        this.usedMemory = process.memoryUsage().rss / 1024 / 1024;\n        return {\n            MemoryUsage: this.usedMemory,\n            TotalRecords: this.totalRecords,\n            MaxMemoryMB: this.maxMemoryMB,\n            maxRecords: this.maxRecords,\n        };\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5f5a3aad9bad0c703e9d43664699086f768f39fa","contentHash":"9b423e5ae2bf058892f877d666e8fa26e18434431d399abcd4a738646d630981"},"/Users/esteban/node-memcached/server/src/record.js":{"path":"/Users/esteban/node-memcached/server/src/record.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":7,"column":30},"end":{"line":7,"column":47}},"3":{"start":{"line":11,"column":4},"end":{"line":15,"column":5}},"4":{"start":{"line":12,"column":6},"end":{"line":12,"column":55}},"5":{"start":{"line":14,"column":6},"end":{"line":14,"column":35}},"6":{"start":{"line":17,"column":4},"end":{"line":17,"column":23}},"7":{"start":{"line":18,"column":4},"end":{"line":18,"column":23}},"8":{"start":{"line":19,"column":4},"end":{"line":19,"column":31}},"9":{"start":{"line":20,"column":4},"end":{"line":20,"column":23}},"10":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"11":{"start":{"line":32,"column":6},"end":{"line":32,"column":18}},"12":{"start":{"line":35,"column":4},"end":{"line":35,"column":74}},"13":{"start":{"line":36,"column":4},"end":{"line":36,"column":40}},"14":{"start":{"line":41,"column":0},"end":{"line":41,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":10,"column":2},"end":{"line":10,"column":3}},"loc":{"start":{"line":10,"column":40},"end":{"line":21,"column":3}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":30,"column":2},"end":{"line":30,"column":3}},"loc":{"start":{"line":30,"column":12},"end":{"line":37,"column":3}},"line":30}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":4},"end":{"line":15,"column":5}},"type":"if","locations":[{"start":{"line":11,"column":4},"end":{"line":15,"column":5}},{"start":{"line":11,"column":4},"end":{"line":15,"column":5}}],"line":11},"1":{"loc":{"start":{"line":11,"column":8},"end":{"line":11,"column":60}},"type":"binary-expr","locations":[{"start":{"line":11,"column":8},"end":{"line":11,"column":22}},{"start":{"line":11,"column":26},"end":{"line":11,"column":60}}],"line":11},"2":{"loc":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},{"start":{"line":31,"column":4},"end":{"line":33,"column":5}}],"line":31}},"s":{"0":1,"1":1,"2":1,"3":9,"4":7,"5":2,"6":9,"7":9,"8":9,"9":9,"10":13,"11":2,"12":11,"13":11,"14":1},"f":{"0":9,"1":13},"b":{"0":[7,2],"1":[9,7],"2":[2,11]},"inputSourceMap":{"version":3,"sources":["record.js"],"names":["MAX_EXPIRATION_OFFSET","Record","constructor","value","expiration","flags","Date","now","uniqueCas","length","isValid","console","debug"],"mappings":";;;;;;AAAA,MAAMA,qBAAqB,GAAG,KAAK,EAAL,GAAU,EAAV,GAAe,EAA7C;;AAEe,MAAMC,MAAN,CAAa;AACxBC,EAAAA,WAAW,CAACC,KAAD,EAAQC,UAAR,EAAoBC,KAApB,EAA2B;AAClC,QAAID,UAAU,GAAG,CAAb,IAAkBA,UAAU,GAAGJ,qBAAnC,EAA0D;AACtD,WAAKI,UAAL,GAAkBE,IAAI,CAACC,GAAL,KAAcH,UAAU,GAAG,IAA7C;AACH,KAFD,MAEO;AACH,WAAKA,UAAL,GAAkBA,UAAlB;AACH;;AACD,SAAKI,SAAL,GAAiB,CAAjB;AACA,SAAKL,KAAL,GAAaA,KAAb;AACA,SAAKM,MAAL,GAAcN,KAAK,CAACM,MAApB;AACA,SAAKJ,KAAL,GAAaA,KAAb;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;;;AACIK,EAAAA,OAAO,GAAG;AACN,QAAI,CAAC,KAAKN,UAAV,EAAsB;AAClB,aAAO,IAAP;AACH;;AACDO,IAAAA,OAAO,CAACC,KAAR,CAAc,yBAAd,EAAyCN,IAAI,CAACC,GAAL,EAAzC,EAAqD,KAAKH,UAA1D;AACA,WAAQE,IAAI,CAACC,GAAL,KAAa,KAAKH,UAA1B;AACH;;AAzBuB","sourceRoot":"/Users/esteban/node-memcached/server/src/","sourcesContent":["const MAX_EXPIRATION_OFFSET = 60 * 60 * 24 * 30;\n\nexport default class Record {\n    constructor(value, expiration, flags) {\n        if (expiration > 0 && expiration < MAX_EXPIRATION_OFFSET) {\n            this.expiration = Date.now() + (expiration * 1000);\n        } else {\n            this.expiration = expiration;\n        }\n        this.uniqueCas = 1;\n        this.value = value;\n        this.length = value.length;\n        this.flags = flags;\n    }\n\n    /**\n     * Determines a records validity based on expiration date.\n     * If 0 is passed as expiration, the record doesn't expire.\n     * Nonetheless it could be evicted if the memory is full.\n     * @returns Boolean\n     */\n    isValid() {\n        if (!this.expiration) {\n            return true;\n        }\n        console.debug('Now: %s, expiration: %s', Date.now(), this.expiration);\n        return (Date.now() < this.expiration);\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ac9eaaf328eb29502f8f79c551b135f810895c34","contentHash":"bc1bfbb6055f46d4a99e467b8e7d36f63e7fc847b311593161f1f46845df3906"}}